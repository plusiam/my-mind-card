<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë§Œì˜ ë§ˆìŒ ë¹„ë²• ë§Œë“¤ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .font-gowun { font-family: 'Gowun Dodum', serif; }
        .icon-selected {
            transform: scale(1.25);
            color: #F59E0B; /* Tailwind amber-500 */
            text-shadow: 0 0 8px rgba(245, 158, 11, 0.5);
        }

        @media print {
            body * { visibility: hidden; }
            #printableCardArea, #printableCardArea * { visibility: visible; }
            #printableCardArea {
                position: absolute; left: 0; top: 0; width: 100%; height: auto; min-height: 100vh; 
                margin: 0; padding: 15px; /* íŒ¨ë”©ì„ ì¡°ê¸ˆ ì¤„ì—¬ì„œ A4ì— ê½‰ ì°¨ê²Œ */
                border: none !important; box-shadow: none !important;
                display: flex; align-items: center; justify-content: center; /* ì¸ì‡„ ì‹œ ì¤‘ì•™ ì •ë ¬ */
            }
            #printableCardArea > div { /* ë‚´ë¶€ ì¹´ë“œ ì‹¤ì œ í¬ê¸° ì œì–´ */
                width: 100%; max-width: 768px; /* A4 ìš©ì§€ í­ì— ë§ì¶˜ ìµœëŒ€ ë„ˆë¹„ */
                margin: auto;
            }
            .no-print { display: none !important; }
            /* ì¸ì‡„ ì‹œ ë°°ê²½ìƒ‰ ê°•ì œ ì ìš© (í•„ìš”í•œ ê²½ìš°) */
            /* .print-bg-force { -webkit-print-color-adjust: exact; print-color-adjust: exact; } */
        }
    </style>
</head>
<body class="bg-sky-50 flex items-center justify-center min-h-screen p-4 sm:p-6">

    <div class="w-full max-w-3xl mx-auto">
        <div id="mainFormContainer" class="bg-white rounded-2xl shadow-lg p-6 sm:p-10 space-y-8">
            <header class="text-center">
                <h1 class="text-3xl sm:text-4xl font-bold text-sky-800">ë‚˜ë§Œì˜ ë§ˆìŒ ë¹„ë²• ë§Œë“¤ê¸° âœ¨</h1>
                <p class="text-gray-500 mt-2">í˜ë“¤ì—ˆë˜ ë§ˆìŒì„ ë‹¤ë…ì—¬ì£¼ëŠ” ë‚˜ë§Œì˜ ë¹„ë²•ì„ ë§Œë“¤ì–´ ë³´ì•„ìš”!</p>
            </header>

            <form id="mindForm" class="space-y-8">
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 bg-sky-50 p-4 rounded-lg">
                    <div>
                        <label for="schoolName" class="font-semibold text-gray-800">í•™êµ ì´ë¦„</label>
                        <input type="text" id="schoolName" name="schoolName" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition" placeholder="ì˜ˆ: ë§ˆìŒì´ˆë“±í•™êµ">
                    </div>
                    <div>
                        <label for="className" class="font-semibold text-gray-800">í•™ë…„/ë°˜</label>
                        <input type="text" id="className" name="className" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition" placeholder="ì˜ˆ: 5í•™ë…„ 1ë°˜">
                    </div>
                    <div>
                        <label for="studentName" class="font-semibold text-gray-800">ì´ë¦„</label>
                        <input type="text" id="studentName" name="studentName" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition" placeholder="ì˜ˆ: í™ê¸¸ë™">
                    </div>
                </div>
                
                <div>
                    <label for="toughMoment" class="text-xl font-semibold text-gray-800 block mb-2">ğŸ§  1. ë§ˆìŒì´ í˜ë“¤ì—ˆë˜ ìˆœê°„ì€ ì–¸ì œì˜€ë‚˜ìš”?</label>
                    <p class="text-sm text-gray-500 mb-3">(ì˜ˆ: ì¹œêµ¬ë‘ ì‹¸ì› ì„ ë•Œ, ì‹œí—˜ì„ ë§ì³¤ì„ ë•Œ ë“±)</p>
                    <textarea id="toughMoment" name="toughMoment" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition" placeholder="ì—¬ê¸°ì— ì†”ì§í•œ ë§ˆìŒì„ ì ì–´ë³´ì„¸ìš”..."></textarea>
                </div>

                <div>
                    <label class="text-xl font-semibold text-gray-800 block mb-3">ğŸ’¬ 2. ê·¸ë•Œ ë‚˜ëŠ” ì–´ë–¤ ê¸°ë¶„ì´ ë“¤ì—ˆë‚˜ìš”?</label>
                    <div class="flex flex-wrap gap-x-6 gap-y-3">
                        <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="feeling" value="ìŠ¬íì–´" class="text-sky-500 focus:ring-sky-400 h-4 w-4"><span>ğŸ˜¢ ìŠ¬íì–´</span></label>
                        <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="feeling" value="í™”ë‚¬ì–´" class="text-sky-500 focus:ring-sky-400 h-4 w-4"><span>ğŸ˜¡ í™”ë‚¬ì–´</span></label>
                        <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="feeling" value="ë¶ˆì•ˆí–ˆì–´" class="text-sky-500 focus:ring-sky-400 h-4 w-4"><span>ğŸ˜¨ ë¶ˆì•ˆí–ˆì–´</span></label>
                        <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="feeling" value="ì†ìƒí–ˆì–´" class="text-sky-500 focus:ring-sky-400 h-4 w-4"><span>ğŸ˜ ì†ìƒí–ˆì–´</span></label>
                        <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="feeling" value="ì™¸ë¡œì› ì–´" class="text-sky-500 focus:ring-sky-400 h-4 w-4"><span>ğŸ˜” ì™¸ë¡œì› ì–´</span></label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="feeling" value="ê¸°íƒ€" class="text-sky-500 focus:ring-sky-400 h-4 w-4">
                            <span>ğŸ˜Š ê¸°íƒ€:</span>
                            <input type="text" id="feelingEtc" name="feelingEtc" class="border-b-2 border-gray-300 focus:border-sky-500 outline-none w-24 transition">
                        </label>
                    </div>
                </div>

                <div>
                    <label for="solution" class="text-xl font-semibold text-gray-800 block mb-2">ğŸ’¡ 3. ê·¸ ê¸°ë¶„ì„ ë‹¬ë˜ê¸° ìœ„í•´ ë‚´ê°€ í–ˆë˜ ì¼ ë˜ëŠ” í•˜ê³  ì‹¶ì€ ì¼ì€?</label>
                    <p class="text-sm text-gray-500 mb-3">(ì˜ˆ: ì¢‹ì•„í•˜ëŠ” ë…¸ë˜ ë“£ê¸°, í˜¼ì ìˆê¸°, ê¹Šì€ ìˆ¨ ì‰¬ê¸° ë“±)</p>
                    <textarea id="solution" name="solution" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition" placeholder="ì–´ë–¤ í–‰ë™ì´ ë‚˜ì—ê²Œ ë„ì›€ì´ ë˜ì—ˆë‚˜ìš”?"></textarea>
                </div>

                <div>
                    <label for="secretName" class="text-xl font-semibold text-gray-800 block mb-2">âœ¨ 4. ìœ„ ë°©ë²•ì— ë‚˜ë§Œì˜ â€˜ë¹„ë²• ì´ë¦„â€™ì„ ë¶™ì—¬ë³¼ê¹Œìš”?</label>
                    <p class="text-sm text-gray-500 mb-3">(ì˜ˆ: ê±±ì • ë‚ ë¦¬ê¸° ë°”ëŒ, ê¸°ë¶„ ë°˜ì§ë°˜ì§ ì¶©ì „í•˜ê¸° ë“±)</p>
                    <input type="text" id="secretName" name="secretName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition" placeholder="ë‚˜ë§Œì˜ ë©‹ì§„ ë¹„ë²• ì´ë¦„ì„ ë§Œë“¤ì–´ì£¼ì„¸ìš”!">
                </div>
                
                <div>
                    <label class="text-xl font-semibold text-gray-800 block mb-3">ğŸ¨ 5. ë‚´ ë§ˆìŒ ë¹„ë²•ì„ ì•„ì´ì½˜ìœ¼ë¡œ í‘œí˜„í•´ë´ìš”!</label>
                    <div id="iconSelector" class="flex justify-center items-center space-x-4 sm:space-x-8 py-2">
                        <span class="text-4xl sm:text-5xl cursor-pointer transition-transform duration-200 hover:scale-125" data-icon="âœ¨">âœ¨</span>
                        <span class="text-4xl sm:text-5xl cursor-pointer transition-transform duration-200 hover:scale-125" data-icon="ğŸ’–">ğŸ’–</span>
                        <span class="text-4xl sm:text-5xl cursor-pointer transition-transform duration-200 hover:scale-125" data-icon="ğŸ¨">ğŸ¨</span>
                        <span class="text-4xl sm:text-5xl cursor-pointer transition-transform duration-200 hover:scale-125" data-icon="ğŸ’¡">ğŸ’¡</span>
                        <span class="text-4xl sm:text-5xl cursor-pointer transition-transform duration-200 hover:scale-125" data-icon="ğŸ˜Š">ğŸ˜Š</span>
                        <span class="text-4xl sm:text-5xl cursor-pointer transition-transform duration-200 hover:scale-125" data-icon="â­">â­</span>
                        <span class="text-4xl sm:text-5xl cursor-pointer transition-transform duration-200 hover:scale-125" data-icon="ğŸš€">ğŸš€</span>
                    </div>
                    <input type="hidden" id="selectedIcon" name="selectedIcon">
                </div>

                <div>
                    <label for="usageTime" class="text-xl font-semibold text-gray-800 block mb-2">ğŸ’– 6. ì´ ë¹„ë²•ì„ ì–¸ì œ ì“°ë©´ ì¢‹ì„ê¹Œìš”?</label>
                    <textarea id="usageTime" name="usageTime" rows="2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition" placeholder="ì´ ë¹„ë²•ì´ í•„ìš”í•œ ìˆœê°„ì„ ì ì–´ë³´ì„¸ìš”."></textarea>
                </div>

                <div class="flex flex-col sm:flex-row gap-4 pt-4">
                    <button type="button" id="previewBtn" class="w-full sm:flex-1 bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-6 rounded-lg transition-transform duration-150 hover:scale-105 shadow-md">âœ¨ ì¹´ë“œ ë¯¸ë¦¬ë³´ê¸°</button>
                    <button type="button" id="resetBtn" class="w-full sm:flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-lg transition-transform duration-150 hover:scale-105 shadow-md">ğŸ”„ ë‹¤ì‹œ ì“¸ë˜ìš”</button>
                </div>
            </form>
        </div>

        <div id="previewModal" class="hidden fixed inset-0 bg-black/75 flex items-center justify-center p-4 z-50 transition-opacity duration-300 no-print">
            <div class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl relative max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <button id="closeModalBtn" class="absolute top-3 right-3 bg-gray-100 hover:bg-gray-300 text-gray-700 rounded-full p-1 w-8 h-8 flex items-center justify-center text-2xl font-bold leading-none">&times;</button>
                <h2 class="text-2xl font-bold text-center text-sky-700 mb-6">ë¯¸ë¦¬ë³´ê¸°: ë‚˜ë§Œì˜ ë§ˆìŒ ë¹„ë²• ì¹´ë“œ</h2>
                <div id="modalCardContentWrapper">
                    </div>
                <div class="mt-6 text-center space-y-3 sm:space-y-0 sm:space-x-3">
                    <button type="button" id="printFromModalBtn" class="w-full sm:w-auto bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 px-5 rounded-lg transition shadow-md">ğŸ–¨ï¸ ì¸ì‡„ / PDFë¡œ ì €ì¥</button>
                    <button type="button" id="saveAsImageBtn" class="w-full sm:w-auto bg-blue-500 hover:bg-blue-600 text-white font-bold py-2.5 px-5 rounded-lg transition shadow-md">ğŸ“· ê·¸ë¦¼ íŒŒì¼ë¡œ ì €ì¥</button>
                </div>
            </div>
        </div>

        <div id="printableCardArea" class="hidden"></div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('mindForm');
            const previewBtn = document.getElementById('previewBtn');
            const resetBtn = document.getElementById('resetBtn');
            const resultCard = document.getElementById('printableCardArea'); // ì¸ì‡„ ëŒ€ìƒ
            const modalCardContentWrapper = document.getElementById('modalCardContentWrapper');
            
            const iconSelector = document.getElementById('iconSelector');
            const selectedIconInput = document.getElementById('selectedIcon');
            const icons = iconSelector.querySelectorAll('span');

            const previewModal = document.getElementById('previewModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const printFromModalBtn = document.getElementById('printFromModalBtn');
            const saveAsImageBtn = document.getElementById('saveAsImageBtn');

            icons.forEach(icon => {
                icon.addEventListener('click', () => {
                    icons.forEach(i => i.classList.remove('icon-selected'));
                    icon.classList.add('icon-selected');
                    selectedIconInput.value = icon.dataset.icon;
                });
            });

            resetBtn.addEventListener('click', () => {
                form.reset();
                resultCard.innerHTML = ''; // ì¸ì‡„ìš© ì¹´ë“œ ë‚´ìš©ë„ ì´ˆê¸°í™”
                modalCardContentWrapper.innerHTML = ''; // ëª¨ë‹¬ì°½ ë‚´ìš©ë„ ì´ˆê¸°í™”
                previewModal.classList.add('hidden');
                icons.forEach(i => i.classList.remove('icon-selected'));
                selectedIconInput.value = '';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            function checkFormValidity() {
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());
                const requiredFields = ['schoolName', 'className', 'studentName', 'toughMoment', 'feeling', 'solution', 'secretName', 'selectedIcon', 'usageTime'];
                
                if (data.feeling === 'ê¸°íƒ€' && !data.feelingEtc.trim()) {
                    alert('ê¸°íƒ€ ê°ì •ì„ ì„ íƒí•˜ì…¨ìœ¼ë©´, ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”! ğŸ˜Š');
                    document.getElementById('feelingEtc').focus();
                    return false;
                }

                const missingField = requiredFields.find(field => {
                    if (field === 'feeling' && data.feeling === 'ê¸°íƒ€') return false; // ê¸°íƒ€ëŠ” feelingEtcë¡œ ì²´í¬
                    return !data[field] || !data[field].trim();
                });
                
                if (missingField) {
                    alert('ëª¨ë“  í•­ëª©ì„ ì±„ì›Œì£¼ì„¸ìš”! ğŸ˜Š (ì•„ì´ì½˜ë„ ê¼­ ì„ íƒí•´ì£¼ì„¸ìš”!)');
                    const targetElement = document.getElementById(missingField);
                    if (targetElement) targetElement.focus();
                    return false; 
                }
                return data;
            }
            
            function generateCardHTML(data) {
                let feeling = data.feeling;
                if (feeling === 'ê¸°íƒ€' && data.feelingEtc) {
                    feeling = data.feelingEtc;
                } else if (feeling === 'ê¸°íƒ€') {
                    feeling = 'ë‚˜ë§Œì˜ ëŠë‚Œ';
                }

                // ìë™ í°íŠ¸ í¬ê¸° ì¡°ì ˆ ë¡œì§
                let toughMomentClasses = "font-gowun text-gray-800 leading-relaxed p-3 bg-sky-50 rounded-lg mt-1";
                if (data.toughMoment.length > 100) toughMomentClasses += " text-sm";
                if (data.toughMoment.length > 200) toughMomentClasses = toughMomentClasses.replace("text-sm", "text-xs");

                let solutionClasses = "font-gowun text-gray-800 leading-relaxed p-3 bg-yellow-50 rounded-lg mt-1";
                if (data.solution.length > 100) solutionClasses += " text-sm";
                if (data.solution.length > 200) solutionClasses = solutionClasses.replace("text-sm", "text-xs");
                
                let usageTimeClasses = "font-gowun text-gray-800 leading-relaxed p-3 bg-sky-50 rounded-lg mt-1";
                if (data.usageTime.length > 80) usageTimeClasses += " text-sm";
                if (data.usageTime.length > 150) usageTimeClasses = usageTimeClasses.replace("text-sm", "text-xs");


                return `
                    <div class="bg-gradient-to-br from-sky-100 via-yellow-50 to-pink-100 p-6 rounded-xl shadow-lg border-2 border-white">
                        <div class="text-xs text-gray-500 text-right mb-4">
                            ${data.schoolName} ${data.className} <span class="font-semibold">${data.studentName}</span>
                        </div>
                        <div class="text-center mb-6">
                            <span class="text-6xl sm:text-7xl">${data.selectedIcon || 'ğŸ’Œ'}</span>
                            <h2 class="text-3xl sm:text-4xl font-bold text-sky-700 mt-2 break-words">${data.secretName}</h2>
                            <p class="text-gray-600 text-sm">${data.studentName}ì˜ ì†Œì¤‘í•œ ë§ˆìŒ ë¹„ë²• ì¹´ë“œ</p>
                        </div>
                        <div class="space-y-5">
                            <div>
                                <h3 class="font-semibold text-lg text-sky-600 flex items-center mb-1">ğŸ§  ë§ˆìŒì´ í˜ë“¤ì—ˆë˜ ìˆœê°„...</h3>
                                <p class="${toughMomentClasses}">${data.toughMoment}</p>
                            </div>
                            <div>
                                <h3 class="font-semibold text-lg text-sky-600 flex items-center mb-1">ğŸ’¬ ê·¸ë•Œ ë‚´ ë§ˆìŒì€...</h3>
                                <p class="font-gowun text-gray-800 leading-relaxed p-3 bg-sky-50 rounded-lg mt-1">${feeling}</p>
                            </div>
                            <div>
                                <h3 class="font-semibold text-lg text-yellow-600 flex items-center mb-1">ğŸ’¡ ë‚˜ë¥¼ ìœ„í•œ í•´ê²°ì±…ì€!</h3>
                                <p class="${solutionClasses}">${data.solution}</p>
                            </div>
                            <div>
                                <h3 class="font-semibold text-lg text-sky-600 flex items-center mb-1">ğŸ’– ì´ ë¹„ë²•ì€ ì´ëŸ´ ë•Œ í•„ìš”í•´!</h3>
                                <p class="${usageTimeClasses}">${data.usageTime}</p>
                            </div>
                        </div>
                        <div class="mt-8 text-center text-xs text-gray-400">
                            ì´ ì¹´ë“œëŠ” ${new Date().toLocaleDateString('ko-KR')}ì— ë§Œë“¤ì–´ì¡Œì–´ìš”. í•„ìš”í•  ë•Œë§ˆë‹¤ êº¼ë‚´ë³´ì•„ìš”!
                        </div>
                    </div>
                `;
            }

            previewBtn.addEventListener('click', () => {
                const data = checkFormValidity();
                if (!data) return;
                
                const cardHTML = generateCardHTML(data);
                modalCardContentWrapper.innerHTML = cardHTML; // ëª¨ë‹¬ì— ì¹´ë“œ ë‚´ìš© ì±„ìš°ê¸°
                resultCard.innerHTML = cardHTML; // ì¸ì‡„ìš© ìˆ¨ê²¨ì§„ divì—ë„ ë™ì¼ ë‚´ìš© ì±„ìš°ê¸°
                previewModal.classList.remove('hidden');
            });
            
            closeModalBtn.addEventListener('click', () => {
                previewModal.classList.add('hidden');
            });

            printFromModalBtn.addEventListener('click', () => {
                // ì¸ì‡„ ì‹œì—ëŠ” #printableCardAreaì˜ ë‚´ìš©ì´ ì‚¬ìš©ë¨
                window.print();
            });

            saveAsImageBtn.addEventListener('click', async () => {
                saveAsImageBtn.innerText = 'ê·¸ë¦¼ ì €ì¥ ì¤‘...';
                saveAsImageBtn.disabled = true;

                const elementToCapture = document.querySelector('#modalCardContentWrapper > div'); // ëª¨ë‹¬ ì•ˆì˜ ì‹¤ì œ ì¹´ë“œ div
                if (!elementToCapture) {
                    console.error("Error: Card content not found in modal for image capture.");
                    alert("ì˜¤ë¥˜: ì¹´ë“œ ë‚´ìš©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    saveAsImageBtn.innerText = 'ğŸ“· ê·¸ë¦¼ íŒŒì¼ë¡œ ì €ì¥';
                    saveAsImageBtn.disabled = false;
                    return;
                }
                
                await new Promise(resolve => setTimeout(resolve, 300)); // ë Œë”ë§ ëŒ€ê¸°

                try {
                    const canvas = await html2canvas(elementToCapture, {
                        scale: 2,
                        useCORS: true,
                        backgroundColor: '#ffffff' // í°ìƒ‰ ë°°ê²½ìœ¼ë¡œ PNG ì €ì¥
                    });
                    const imageUrl = canvas.toDataURL('image/png');
                    const link = document.createElement('a');
                    link.href = imageUrl;
                    link.download = (document.getElementById('secretName').value || 'ë‚˜ì˜ë§ˆìŒë¹„ë²•ì¹´ë“œ') + '.png';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } catch (error) {
                    console.error("Error generating image:", error);
                    alert("ê·¸ë¦¼ íŒŒì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                } finally {
                    saveAsImageBtn.innerText = 'ğŸ“· ê·¸ë¦¼ íŒŒì¼ë¡œ ì €ì¥';
                    saveAsImageBtn.disabled = false;
                }
            });

        });
    </script>

</body>
</html>
