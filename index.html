<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>나만의 마음 비법 만들기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 추가적인 스타일링 */
        .icon-selected {
            transform: scale(1.2);
            color: #FBBF24; /* Tailwind yellow-400 */
        }

        /* V4 변경: 인쇄 전용 스타일 */
        @media print {
            /* 페이지의 모든 요소를 기본적으로 숨김 */
            body * {
                visibility: hidden;
            }
            /* 결과 카드와 그 안의 내용만 보이도록 설정 */
            #resultCard, #resultCard * {
                visibility: visible;
            }
            /* 인쇄 시 결과 카드가 페이지 전체를 차지하도록 설정 */
            #resultCard {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 1.5rem;
                border: none !important;
                box-shadow: none !important;
            }
            /* 인쇄 시에는 '인쇄 버튼' 자체는 보이지 않도록 함 */
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-sky-50 flex items-center justify-center min-h-screen p-4 sm:p-6">

    <div class="w-full max-w-3xl mx-auto">
        <div id="mainFormContainer" class="bg-white rounded-2xl shadow-lg p-6 sm:p-10 space-y-8">
            <header class="text-center">
                <h1 class="text-3xl sm:text-4xl font-bold text-sky-800">나만의 마음 비법 만들기 ✨</h1>
                <p class="text-gray-500 mt-2">힘들었던 마음을 다독여주는 나만의 비법을 만들어 보아요!</p>
            </header>

            <form id="mindForm" class="space-y-8">
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 bg-sky-50 p-4 rounded-lg">
                    <div>
                        <label for="schoolName" class="font-semibold text-gray-800">학교 이름</label>
                        <input type="text" id="schoolName" name="schoolName" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition" placeholder="예: 마음초등학교">
                    </div>
                    <div>
                        <label for="className" class="font-semibold text-gray-800">학년/반</label>
                        <input type="text" id="className" name="className" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition" placeholder="예: 5학년 1반">
                    </div>
                    <div>
                        <label for="studentName" class="font-semibold text-gray-800">이름</label>
                        <input type="text" id="studentName" name="studentName" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition" placeholder="예: 홍길동">
                    </div>
                </div>
                
                <div>
                    <label for="toughMoment" class="text-xl font-semibold text-gray-800 block mb-2">🧠 1. 마음이 힘들었던 순간은 언제였나요?</label>
                    <p class="text-sm text-gray-500 mb-3">(예: 친구랑 싸웠을 때, 시험을 망쳤을 때 등)</p>
                    <textarea id="toughMoment" name="toughMoment" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition" placeholder="여기에 솔직한 마음을 적어보세요..."></textarea>
                </div>

                <div>
                    <label class="text-xl font-semibold text-gray-800 block mb-3">💬 2. 그때 나는 어떤 기분이 들었나요?</label>
                    <div class="flex flex-wrap gap-x-6 gap-y-3">
                        <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="feeling" value="슬펐어" class="text-sky-500 focus:ring-sky-400"><span>😢 슬펐어</span></label>
                        <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="feeling" value="화났어" class="text-sky-500 focus:ring-sky-400"><span>😡 화났어</span></label>
                        <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="feeling" value="불안했어" class="text-sky-500 focus:ring-sky-400"><span>😨 불안했어</span></label>
                        <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="feeling" value="속상했어" class="text-sky-500 focus:ring-sky-400"><span>😞 속상했어</span></label>
                        <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="feeling" value="외로웠어" class="text-sky-500 focus:ring-sky-400"><span>😔 외로웠어</span></label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="feeling" value="기타" class="text-sky-500 focus:ring-sky-400">
                            <span>😊 기타:</span>
                            <input type="text" id="feelingEtc" name="feelingEtc" class="border-b-2 border-gray-300 focus:border-sky-500 outline-none w-24 transition">
                        </label>
                    </div>
                </div>

                <div>
                    <label for="solution" class="text-xl font-semibold text-gray-800 block mb-2">💡 3. 그 기분을 달래기 위해 내가 했던 일 또는 하고 싶은 일은?</label>
                    <p class="text-sm text-gray-500 mb-3">(예: 좋아하는 노래 듣기, 혼자 있기, 깊은 숨 쉬기 등)</p>
                    <textarea id="solution" name="solution" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition" placeholder="어떤 행동이 나에게 도움이 되었나요?"></textarea>
                </div>

                <div>
                    <label for="secretName" class="text-xl font-semibold text-gray-800 block mb-2">✨ 4. 위 방법에 나만의 ‘비법 이름’을 붙여볼까요?</label>
                    <p class="text-sm text-gray-500 mb-3">(예: 걱정 날리기 바람, 기분 반짝반짝 충전하기 등)</p>
                    <input type="text" id="secretName" name="secretName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition" placeholder="나만의 멋진 비법 이름을 만들어주세요!">
                </div>
                
                <div>
                    <label class="text-xl font-semibold text-gray-800 block mb-3">🎨 5. 내 마음 비법을 아이콘으로 표현해봐요!</label>
                    <div id="iconSelector" class="flex justify-center items-center space-x-4 sm:space-x-8 py-2">
                        <span class="text-4xl sm:text-5xl cursor-pointer transition-transform duration-200 hover:scale-125" data-icon="✨">✨</span>
                        <span class="text-4xl sm:text-5xl cursor-pointer transition-transform duration-200 hover:scale-125" data-icon="💖">💖</span>
                        <span class="text-4xl sm:text-5xl cursor-pointer transition-transform duration-200 hover:scale-125" data-icon="🎨">🎨</span>
                        <span class="text-4xl sm:text-5xl cursor-pointer transition-transform duration-200 hover:scale-125" data-icon="💡">💡</span>
                        <span class="text-4xl sm:text-5xl cursor-pointer transition-transform duration-200 hover:scale-125" data-icon="😊">😊</span>
                    </div>
                    <input type="hidden" id="selectedIcon" name="selectedIcon">
                </div>

                <div>
                    <label for="usageTime" class="text-xl font-semibold text-gray-800 block mb-2">💖 6. 이 비법을 언제 쓰면 좋을까요?</label>
                    <textarea id="usageTime" name="usageTime" rows="2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition" placeholder="이 비법이 필요한 순간을 적어보세요."></textarea>
                </div>

                <div class="flex flex-col sm:flex-row gap-4 pt-4">
                    <button type="button" id="submitBtn" class="w-full sm:w-2/3 bg-yellow-400 hover:bg-yellow-500 text-white font-bold py-3 px-6 rounded-lg transition-transform duration-200 hover:scale-105 shadow-md">
                        나의 비법 카드 만들기!
                    </button>
                    <button type="button" id="resetBtn" class="w-full sm:w-1/3 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-lg transition-transform duration-200 hover:scale-105 shadow-md">
                        다시 쓸래요
                    </button>
                </div>
            </form>
        </div>

        <div id="resultCard" class="bg-white rounded-2xl shadow-lg p-6 sm:p-10 mt-10 border-4 border-dashed border-sky-300 hidden">
            <div id="resultContent" class="space-y-6"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('mindForm');
            const submitBtn = document.getElementById('submitBtn');
            const resetBtn = document.getElementById('resetBtn');
            const resultCard = document.getElementById('resultCard');
            const resultContent = document.getElementById('resultContent');
            const iconSelector = document.getElementById('iconSelector');
            const selectedIconInput = document.getElementById('selectedIcon');
            const icons = iconSelector.querySelectorAll('span');

            icons.forEach(icon => {
                icon.addEventListener('click', () => {
                    icons.forEach(i => i.classList.remove('icon-selected'));
                    icon.classList.add('icon-selected');
                    selectedIconInput.value = icon.dataset.icon;
                });
            });

            resetBtn.addEventListener('click', () => {
                form.reset();
                resultCard.classList.add('hidden');
                icons.forEach(i => i.classList.remove('icon-selected'));
                selectedIconInput.value = '';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            submitBtn.addEventListener('click', () => {
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());

                let feeling = data.feeling;
                if (feeling === '기타' && data.feelingEtc) {
                    feeling = data.feelingEtc;
                } else if (feeling === '기타') {
                    feeling = '나만의 느낌';
                }

                if (!data.schoolName || !data.className || !data.studentName || !data.toughMoment || !feeling || !data.solution || !data.secretName || !data.selectedIcon || !data.usageTime) {
                    alert('모든 항목을 채워주세요! 😊');
                    return;
                }

                // V4 변경: 결과 카드 HTML에 인쇄 버튼 추가
                resultContent.innerHTML = `
                    <div class="text-right text-base text-gray-600 font-semibold">
                        <p>${data.schoolName} ${data.className} ${data.studentName}</p>
                    </div>
                    <div class="text-center">
                        <span class="text-6xl">${data.selectedIcon || '💌'}</span>
                        <h2 class="text-3xl font-bold text-sky-800 mt-2">${data.secretName}</h2>
                        <p class="text-gray-500">${data.studentName} 학생의 소중한 마음 비법 카드</p>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <h3 class="font-semibold text-lg text-gray-700">마음이 힘들었을 때...</h3>
                            <p class="bg-sky-50 p-3 rounded-lg mt-1">${data.toughMoment}</p>
                        </div>
                        <div>
                            <h3 class="font-semibold text-lg text-gray-700">그때 내 마음은...</h3>
                            <p class="bg-sky-50 p-3 rounded-lg mt-1">${feeling}</p>
                        </div>
                        <div>
                            <h3 class="font-semibold text-lg text-gray-700">나를 위한 해결책은!</h3>
                            <p class="bg-yellow-50 p-3 rounded-lg mt-1">${data.solution}</p>
                        </div>
                        <div>
                            <h3 class="font-semibold text-lg text-gray-700">이 비법은 이럴 때 필요해!</h3>
                            <p class="bg-sky-50 p-3 rounded-lg mt-1">${data.usageTime}</p>
                        </div>
                    </div>
                    <div class="text-center mt-8 text-sm text-gray-400">
                        <p>이 카드를 잘 간직하고, 필요할 때마다 꺼내보아요!</p>
                    </div>
                    <div class="mt-8 text-center no-print">
                        <button type="button" id="printBtn" class="bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 px-5 rounded-lg transition-transform duration-200 hover:scale-105 shadow">
                            🖨️ 인쇄 / PDF로 저장
                        </button>
                    </div>
                `;

                resultCard.classList.remove('hidden');
                resultCard.scrollIntoView({ behavior: 'smooth', block: 'start' });

                // V4 변경: 동적으로 생성된 인쇄 버튼에 이벤트 리스너 추가
                const printBtn = document.getElementById('printBtn');
                if (printBtn) {
                    printBtn.addEventListener('click', () => {
                        window.print();
                    });
                }
            });
        });
    </script>

</body>
</html>